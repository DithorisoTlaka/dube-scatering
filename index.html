<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>App Discovery | Home</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F8F9FB; color: #1a1a1a; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-nav { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); }
        .featured-card { transition: transform 0.3s ease; }
        .featured-card:active { transform: scale(0.95); }
        .category-pill.active { background-color: #2563eb; color: white; }
    </style>
</head>
<body class="pb-24">

    <nav class="sticky top-0 z-50 glass-nav border-b border-gray-100 px-6 py-4 flex justify-between items-center">
        <div>
            <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Discover</p>
            <h1 class="text-2xl font-black tracking-tighter">Marketplace</h1>
        </div>
        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden border-2 border-white shadow-sm">
            <i class="fa-solid fa-user text-gray-400"></i>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-6 pt-6">
        
        <div class="relative mb-8">
            <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input type="text" id="search-bar" placeholder="Search apps, games, and more..." 
                class="w-full pl-12 pr-6 py-4 bg-white rounded-2xl shadow-sm border border-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        </div>

        <section class="mb-10">
            <h3 class="text-xl font-black mb-4">Featured</h3>
            <div id="featured-container" class="flex overflow-x-auto gap-4 no-scrollbar snap-x pb-4">
                <div class="animate-pulse bg-gray-200 min-w-[300px] h-48 rounded-[2.5rem]"></div>
            </div>
        </section>

        <section class="mb-8">
            <div id="category-list" class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                <button class="category-pill active px-6 py-2 rounded-full bg-white border border-gray-100 text-sm font-bold shadow-sm whitespace-nowrap" onclick="filterCat('All')">All</button>
                <button class="category-pill px-6 py-2 rounded-full bg-white border border-gray-100 text-sm font-bold shadow-sm whitespace-nowrap" onclick="filterCat('Games')">Games</button>
                <button class="category-pill px-6 py-2 rounded-full bg-white border border-gray-100 text-sm font-bold shadow-sm whitespace-nowrap" onclick="filterCat('Apps')">Apps</button>
                <button class="category-pill px-6 py-2 rounded-full bg-white border border-gray-100 text-sm font-bold shadow-sm whitespace-nowrap" onclick="filterCat('Productivity')">Productivity</button>
            </div>
        </section>

        <section>
            <div class="flex justify-between items-end mb-6">
                <h3 class="text-xl font-black">Top Recommendations</h3>
                <span class="text-blue-600 text-sm font-bold">See All</span>
            </div>
            <div id="app-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </section>
    </main>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-gray-900/90 backdrop-blur-lg rounded-[2.5rem] p-2 shadow-2xl z-[100] border border-white/10">
        <div class="flex justify-around items-center">
            <button class="flex flex-col items-center p-3 text-blue-400">
                <i class="fa-solid fa-house text-lg"></i>
            </button>
            <button class="flex flex-col items-center p-3 text-gray-400 hover:text-white">
                <i class="fa-solid fa-layer-group text-lg"></i>
            </button>
            <button class="flex flex-col items-center p-3 text-gray-400 hover:text-white">
                <i class="fa-solid fa-bolt text-lg"></i>
            </button>
            <button class="flex flex-col items-center p-3 text-gray-400 hover:text-white">
                <i class="fa-solid fa-heart text-lg"></i>
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // USE THE SAME CONFIG AS YOUR ADMIN HUB
        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            databaseURL: "https://homieclothing-da3f7-default-rtdb.firebaseio.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.appspot.com",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let allApps = [];
        let currentFilter = 'All';

        // Fetch Featured (Carousel)
        onValue(ref(db, 'featured'), (snap) => {
            const data = snap.val();
            const container = document.getElementById('featured-container');
            container.innerHTML = "";
            if(data) {
                Object.values(data).forEach(item => {
                    container.innerHTML += `
                        <div class="featured-card relative min-w-[300px] h-48 rounded-[2.5rem] overflow-hidden snap-center shadow-lg">
                            <img src="${item.banner || item.icon}" class="absolute inset-0 w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent p-6 flex flex-col justify-end">
                                <p class="text-blue-400 text-[10px] font-black uppercase tracking-widest">${item.category}</p>
                                <h4 class="text-white text-xl font-black">${item.name}</h4>
                            </div>
                        </div>`;
                });
            }
        });

        // Fetch All Apps
        onValue(ref(db, 'apps'), (snap) => {
            const data = snap.val();
            allApps = data ? Object.values(data).filter(a => a.isConfirmed) : [];
            renderApps();
        });

        function renderApps(filter = 'All', search = '') {
            const grid = document.getElementById('app-grid');
            grid.innerHTML = "";
            
            const filtered = allApps.filter(app => {
                const matchesCat = filter === 'All' || app.category === filter;
                const matchesSearch = app.name.toLowerCase().includes(search.toLowerCase());
                return matchesCat && matchesSearch;
            });

            filtered.forEach(app => {
                grid.innerHTML += `
                    <div class="bg-white p-5 rounded-[2.5rem] border border-gray-100 shadow-sm hover:shadow-md transition group">
                        <div class="flex items-center gap-4 mb-4">
                            <img src="${app.icon}" class="w-16 h-16 rounded-2xl shadow-inner object-cover bg-gray-50">
                            <div class="flex-1">
                                <h4 class="font-black text-lg leading-tight">${app.name}</h4>
                                <p class="text-gray-400 text-xs font-medium">${app.category}</p>
                                <div class="flex text-orange-400 text-[10px] mt-1">
                                    <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                                    <span class="ml-2 text-gray-400 font-bold">5.0</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs mb-5 line-clamp-2 leading-relaxed">${app.description}</p>
                        <a href="${app.downloadUrl}" target="_blank" class="block w-full text-center bg-gray-100 text-blue-600 py-3 rounded-2xl font-black text-sm group-hover:bg-blue-600 group-hover:text-white transition transform active:scale-95">
                            GET
                        </a>
                    </div>`;
            });
        }

        // Search listener
        document.getElementById('search-bar').oninput = (e) => {
            renderApps(currentFilter, e.target.value);
        };

        // Category Filter
        window.filterCat = (cat) => {
            currentFilter = cat;
            document.querySelectorAll('.category-pill').forEach(btn => {
                btn.classList.toggle('active', btn.innerText === cat);
            });
            renderApps(cat, document.getElementById('search-bar').value);
        };

    </script>
</body>
</html>
