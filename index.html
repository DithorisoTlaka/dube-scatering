<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>All"Apps | Discover</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .app-card:active { transform: scale(0.96); }
        .sidebar-smooth { transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1), padding 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .content-smooth { transition: margin-left 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .fade-label { transition: opacity 0.3s ease, transform 0.3s ease; }
        @keyframes cardPop {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-pop { animation: cardPop 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .carousel-item { transition: opacity 0.8s ease-in-out; }
        #detail-modal, #download-modal, #confirm-modal, #success-modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .progress-fill { transition: width 0.4s ease-out; }
    </style>
</head>
<body class="bg-[#F2F2F7] text-gray-900 pb-24 md:pb-0">

    <aside id="sidebar" class="hidden md:flex flex-col w-20 hover:w-72 sidebar-smooth fixed h-full bg-white border-r p-4 hover:p-8 z-50 group/sidebar">
        <h1 class="text-3xl font-black text-blue-600 tracking-tighter mb-10 whitespace-nowrap overflow-hidden">
            <span class="inline-block group-hover/sidebar:hidden">A"</span>
            <span class="hidden group-hover/sidebar:inline">All"Apps</span>
        </h1>
        <nav class="space-y-1 flex-1">
            <a href="#" data-tab="Discover" class="nav-link flex items-center bg-blue-50 text-blue-600 px-4 py-3 rounded-2xl font-bold transition-all">
                <i class="fa-solid fa-house text-lg w-6 flex justify-center"></i> 
                <span class="fade-label ml-4 opacity-0 group-hover/sidebar:opacity-100 pointer-events-none">Discover</span>
            </a>
            <a href="#" data-tab="Games" class="nav-link flex items-center text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition-all group">
                <i class="fa-solid fa-gamepad text-lg w-6 flex justify-center group-hover:text-blue-500"></i> 
                <span class="fade-label ml-4 opacity-0 group-hover/sidebar:opacity-100 pointer-events-none">Games</span>
            </a>
            <a href="#" data-tab="Apps" class="nav-link flex items-center text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition-all group">
                <i class="fa-solid fa-layer-group text-lg w-6 flex justify-center group-hover:text-blue-500"></i> 
                <span class="fade-label ml-4 opacity-0 group-hover/sidebar:opacity-100 pointer-events-none">Apps</span>
            </a>
            <a href="#" data-tab="Arcade" class="nav-link flex items-center text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition-all group">
                <i class="fa-solid fa-rocket text-lg w-6 flex justify-center group-hover:text-blue-500"></i> 
                <span class="fade-label ml-4 opacity-0 group-hover/sidebar:opacity-100 pointer-events-none">Arcade</span>
            </a>
        </nav>
        <div id="sidebar-user" onclick="handleAuth()" class="mt-auto flex items-center p-3 bg-gray-50 rounded-2xl cursor-pointer overflow-hidden hover:bg-gray-100 transition">
            <div id="user-avatar-sidebar" class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold shrink-0 overflow-hidden">
                <i class="fa-solid fa-user"></i>
            </div>
            <div class="ml-3 fade-label opacity-0 group-hover/sidebar:opacity-100 whitespace-nowrap">
                <p id="user-name-sidebar" class="text-sm font-bold">Sign In</p>
                <p id="user-status-sidebar" class="text-[10px] text-gray-400">Click to login</p>
            </div>
        </div>
    </aside>

    <main class="md:ml-20 content-smooth min-h-screen">
        <header class="p-6 md:p-10 flex justify-between items-end sticky top-0 z-40 md:static glass md:bg-transparent md:backdrop-blur-none">
            <div>
                <p id="header-date" class="text-[11px] font-extrabold text-gray-400 uppercase tracking-[0.2em]">DATE</p>
                <h1 id="header-title" class="text-4xl font-black tracking-tight">Today</h1>
            </div>
            <div class="hidden md:block w-80">
                <div class="relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="app-search" placeholder="Search apps..." class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-100 transition shadow-sm">
                </div>
            </div>
        </header>

        <section class="px-6 md:px-10 pb-12 max-w-7xl">
            <div id="discover-carousel" class="relative w-full h-[500px] rounded-[2.5rem] overflow-hidden shadow-2xl mb-12 group cursor-pointer animate-pop bg-gray-200">
            </div>

            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 id="section-title" class="text-3xl font-black">Must-Have Apps</h2>
                    <p class="text-gray-500 font-medium">Updated just now</p>
                </div>
            </div>

            <div id="app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
    </main>

    <div id="detail-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 md:p-8 bg-black/40 backdrop-blur-md modal-hidden">
        <div id="detail-content" class="bg-white w-full max-w-4xl h-full md:h-auto md:max-h-[90vh] rounded-[3rem] overflow-hidden shadow-2xl relative flex flex-col scale-100 transition-transform">
            <button onclick="closeDetail()" class="absolute top-6 right-6 z-10 w-10 h-10 bg-black/10 hover:bg-black/20 rounded-full flex items-center justify-center transition">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>
            <div id="modal-body" class="overflow-y-auto"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.firebasestorage.app",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112",
            measurementId: "G-2FEJ8K5B2P"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let allAppsRaw = [];
        let remoteAppData = { Discover: [], Games: [], Apps: [], Arcade: [] };
        let slideIndex = 0;
        let carouselTimer;

        const grid = document.getElementById('app-grid');
        const carousel = document.getElementById('discover-carousel');

        // --- FETCH DATA ---
        onValue(ref(db, 'apps'), (snapshot) => {
            const data = snapshot.val();
            allAppsRaw = [];
            remoteAppData = { Discover: [], Games: [], Apps: [], Arcade: [] };
            
            if (data) {
                Object.keys(data).forEach(key => {
                    const appObj = { id: key, ...data[key] };
                    allAppsRaw.push(appObj);
                    const cat = appObj.category || 'Apps';
                    if (remoteAppData[cat]) remoteAppData[cat].push(appObj);
                });
            }
            updateCarousel();
            renderApps('Discover');
        });

        // --- CAROUSEL RENDERER ---
        function updateCarousel() {
            // Filters apps where 'banner' is true
            const featured = allAppsRaw.filter(item => item.banner === true).slice(-5).reverse();

            if (featured.length === 0) {
                carousel.innerHTML = `<div class="flex items-center justify-center h-full bg-gray-200 text-gray-400 font-bold italic">Add apps with banner: true to see them here</div>`;
                return;
            }

            carousel.innerHTML = featured.map((item, i) => `
                <div class="carousel-item absolute inset-0 opacity-0 transition-opacity duration-1000 ${i === 0 ? 'opacity-100' : ''}">
                    <img src="${item.img || 'https://images.unsplash.com/photo-1614332287897-cdc485fa562d?q=80&w=1200'}" 
                         class="absolute inset-0 w-full h-full object-cover transition duration-1000 group-hover:scale-105"
                         onerror="this.src='https://images.unsplash.com/photo-1614332287897-cdc485fa562d?q=80&w=1200'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>
                    <div class="absolute bottom-10 left-10 right-10 text-white">
                        <p class="text-xs font-bold uppercase opacity-70 tracking-widest mb-2">Featured</p>
                        <h2 class="text-5xl font-black mb-4 leading-none">${item.name}</h2>
                        <button onclick="openDetailByKey('${item.id}')" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold text-sm shadow-lg shadow-blue-500/50">View App</button>
                    </div>
                </div>
            `).join('');

            startAutoSlide();
        }

        function startAutoSlide() {
            clearInterval(carouselTimer);
            slideIndex = 0;
            const slides = document.querySelectorAll('.carousel-item');
            if (slides.length <= 1) return;

            carouselTimer = setInterval(() => {
                slides[slideIndex].classList.replace('opacity-100', 'opacity-0');
                slideIndex = (slideIndex + 1) % slides.length;
                slides[slideIndex].classList.replace('opacity-0', 'opacity-100');
            }, 5000);
        }

        // --- APP GRID RENDERER ---
        window.renderApps = (category, filter = '') => {
            grid.innerHTML = '';
            carousel.style.display = category === 'Discover' ? 'block' : 'none';
            const source = (category === 'Discover' ? allAppsRaw : remoteAppData[category] || []);
            const apps = source.filter(app => (app.name || '').toLowerCase().includes(filter.toLowerCase()));
            
            apps.forEach((app, index) => {
                const card = document.createElement('div');
                card.className = "app-card flex items-center space-x-4 bg-white p-5 rounded-[2rem] shadow-sm hover:shadow-xl transition duration-300 cursor-pointer border border-transparent hover:border-blue-100 opacity-0 animate-pop";
                card.style.animationDelay = `${index * 40}ms`;
                card.onclick = () => openDetail(app);

                // Use icon_url if available, else use FontAwesome icon, else use default rocket
                const iconDisplay = app.icon_url 
                    ? `<img src="${app.icon_url}" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${app.name}&background=random'">`
                    : `<i class="fa-solid ${app.icon || 'fa-rocket'}"></i>`;

                card.innerHTML = `
                    <div class="w-20 h-20 bg-gradient-to-br ${app.color || 'from-blue-500 to-indigo-600'} rounded-[1.5rem] flex items-center justify-center text-white text-3xl shrink-0 overflow-hidden shadow-inner">
                        ${iconDisplay}
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-extrabold text-gray-900 truncate text-lg leading-tight">${app.name}</h3>
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">${app.category}</p>
                        <div class="flex items-center justify-between">
                             <button class="bg-[#F0F0F7] text-blue-600 px-6 py-1.5 rounded-full text-xs font-black">${app.price || 'Free'}</button>
                             <div class="flex items-center space-x-1"><span class="text-xs font-bold">${app.rating || '4.9'}</span><i class="fa-solid fa-star text-[10px] text-yellow-400"></i></div>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
        };

        // --- MODAL HELPERS ---
        window.openDetail = (app) => {
            const modalBody = document.getElementById('modal-body');
            const iconDisplay = app.icon_url 
                    ? `<img src="${app.icon_url}" class="w-full h-full object-cover">`
                    : `<i class="fa-solid ${app.icon || 'fa-rocket'}"></i>`;

            modalBody.innerHTML = `
                <img src="${app.img || 'https://images.unsplash.com/photo-1614332287897-cdc485fa562d?q=80&w=1200'}" class="w-full h-72 object-cover" />
                <div class="p-10">
                    <div class="flex items-start space-x-6 mb-8">
                        <div class="w-24 h-24 bg-gradient-to-br ${app.color || 'from-blue-500 to-indigo-600'} rounded-3xl flex items-center justify-center text-white text-4xl overflow-hidden shadow-lg">
                            ${iconDisplay}
                        </div>
                        <div class="flex-1">
                            <h2 class="text-4xl font-black">${app.name}</h2>
                            <p class="text-blue-600 font-bold mb-4">${app.category}</p>
                            <button class="bg-blue-600 text-white px-10 py-3 rounded-full font-black shadow-lg shadow-blue-200 active:scale-95 transition">GET</button>
                        </div>
                    </div>
                    <p class="text-gray-500 text-lg leading-relaxed">${app.desc || 'No description provided.'}</p>
                </div>`;
            document.getElementById('detail-modal').classList.remove('modal-hidden');
        };

        window.openDetailByKey = (id) => {
            const app = allAppsRaw.find(a => a.id === id);
            if(app) openDetail(app);
        };

        window.closeDetail = () => document.getElementById('detail-modal').classList.add('modal-hidden');

        // Global date and search
        document.getElementById('header-date').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        document.getElementById('app-search').addEventListener('input', (e) => renderApps('Discover', e.target.value));

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                const tab = link.getAttribute('data-tab');
                document.getElementById('header-title').innerText = tab === 'Discover' ? 'Today' : tab;
                renderApps(tab);
            });
        });
    </script>
</body>
</html>
